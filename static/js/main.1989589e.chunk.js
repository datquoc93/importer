(this.webpackJsonpimporter=this.webpackJsonpimporter||[]).push([[0],{33:function(e,t,r){e.exports=r(44)},42:function(e,t,r){},44:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),s=r(18),o=r(8),c=(r(42),r(11)),i=r(12),u=r(14),A=r(13),l=r(15),m=r(9);function E(){var e=JSON.parse(localStorage.getItem("user"));return e&&e.token?{Authorization:"Bearer"+e.token}:{}}var h=r(3),d=Object(h.a)(),g=r(10),f=r(28),p=r(29),S={SUCCESS:"ALERT_SUCCESS",ERROR:"ALERT_ERROR",CLEAR:"ALERT_CLEAR"},O={LOGIN_REQUEST:"USERS_LOGIN_REQUEST",LOGIN_SUCCESS:"USERS_LOGIN_SUCCESS",LOGIN_FAILURE:"USERS_LOGIN_FAILURE",LOGOUT:"USER_LOGOUT",GETALL_REQUEST:"USERS_GETALL_REQUEST",GETALL_SUCCESS:"USERS_GETALL_SUCCESS",GETALL_FAILURE:"USERS_GETALL_FAILURE"},L=JSON.parse(localStorage.getItem("user")),C=L?{loggedIn:!0,user:L}:{};var v=Object(g.c)({authentication:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O.LOGIN_REQUEST:case O.LOGIN_SUCCESS:return{loggedIn:!0,user:t.user};case O.LOGIN_FAILURE:case O.LOGOUT:return{};default:return e}},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O.GETALL_REQUEST:return{loading:!0};case O.GETALL_SUCCESS:return{items:t.users};case O.GETALL_FAILURE:return{error:t.error};default:return e}},alert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S.SUCCESS:return{type:"alert-success",message:t.message};case S.ERROR:return{type:"alert-danger",message:t.message};case S.CLEAR:return{};default:return e}}}),b=Object(p.createLogger)(),R=Object(g.d)(v,Object(g.a)(f.a,b)),I={success:function(e){return{type:S.SUCCESS,message:e}},error:function(e){return{type:S.ERROR,message:e}},clear:function(e){return{type:S.CLEAR}}};var U={login:function(e,t){var r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:e,passWd:t})};return fetch("/users/authenticate",r).then(console.log("user")).then((function(e){return localStorage.setItem("user",JSON.stringify(e)),e}))},logout:w,getAll:function(){var e={method:"GET",headers:E()};return fetch("/users",e).then(G)}};function w(){localStorage.removeItem("user")}function G(e){return e.text().then((function(t){var r=t&&JSON.parse(t);if(!e.ok){401===e.status&&(w(),window.location.reload(!0));var n=r&&r.message||e.statusText;return Promise.reject(n)}return r}))}var N={login:function(e,t){return function(r){var n;r((n={userName:e},{type:O.LOGIN_REQUEST,user:n})),U.login(e,t).then((function(e){r(function(e){return{type:O.LOGIN_SUCCESS,user:e}}(e)),d.push("/")}),(function(e){r(function(e){return{type:O.LOGIN_FAILURE,error:e}}(e)),r(I.error(e))}))}},logout:function(){return U.logout(),{type:O.LOGOUT}},getAll:function(){return function(e){e({type:O.GETALL_REQUEST}),U.getAll().then((function(t){return e((r=t,{type:O.GETALL_SUCCESS,user:r}));var r}),(function(t){e(function(e){return{type:O.GETALL_FAILURE,error:e}}(t)),e(I.error(t))}))}}};var j=r(30),y=function(e){var t=e.component,r=Object(j.a)(e,["component"]);return a.a.createElement(m.b,Object.assign({},r,{render:function(e){return localStorage.getItem("user")?a.a.createElement(t,e):a.a.createElement(m.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},T=r(20),Q=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(A.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(N.getAll())}},{key:"render",value:function(){var e=this.props,t=e.user,r=e.users;return a.a.createElement("div",{className:"col-md-6 col-md-offset-3"},a.a.createElement("h1",null,"Hi ",t.firstName,"!"),a.a.createElement("p",null,"You're logged in with React and JWT!!"),a.a.createElement("h3",null,"Users from secure api end point:"),r.loading&&a.a.createElement("em",null,"Loading users..."),r.error&&a.a.createElement("span",{className:"text-danger"},"ERROR: ",r.error),r.items&&a.a.createElement("ul",null,r.items.map((function(e,t){return a.a.createElement("li",{key:e.id},e.firstName+" "+e.lastName)}))),a.a.createElement("p",null,a.a.createElement(T.a,{to:"/login"},"Logout")))}}]),t}(a.a.Component);var k=Object(o.b)((function(e){var t=e.users;return{user:e.authentication.user,users:t}}))(Q),_=r(32),J=r(17),M=function(e){function t(e){var r;return Object(c.a)(this,t),(r=Object(u.a)(this,Object(A.a)(t).call(this,e))).props.dispatch(N.logout()),r.state={username:"",password:"",submitted:!1},r.handleChange=r.handleChange.bind(Object(J.a)(r)),r.handleSubmit=r.handleSubmit.bind(Object(J.a)(r)),r}return Object(l.a)(t,e),Object(i.a)(t,[{key:"handleChange",value:function(e){var t=e.target,r=t.name,n=t.value;this.setState(Object(_.a)({},r,n))}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({submitted:!0});var t=this.state,r=t.username,n=t.password,a=this.props.dispatch;r&&n&&a(N.login(r,n))}},{key:"render",value:function(){var e=this.props.loggingIn,t=this.state,r=t.username,n=t.password,s=t.submitted;return a.a.createElement("div",{className:"col-md-6 col-md-offset-3"},a.a.createElement("h2",null,"Login"),a.a.createElement("form",{name:"form",onSubmit:this.handleSubmit},a.a.createElement("div",{className:"form-group"+(s&&!r?" has-error":"")},a.a.createElement("label",{htmlFor:"username"},"Username"),a.a.createElement("input",{type:"text",className:"form-control",name:"username",value:r,onChange:this.handleChange}),s&&!r&&a.a.createElement("div",{className:"help-block"},"Username is required")),a.a.createElement("div",{className:"form-group"+(s&&!n?" has-error":"")},a.a.createElement("label",{htmlFor:"password"},"Password"),a.a.createElement("input",{type:"password",className:"form-control",name:"password",value:n,onChange:this.handleChange}),s&&!n&&a.a.createElement("div",{className:"help-block"},"Password is required")),a.a.createElement("div",{className:"form-group"},a.a.createElement("button",{className:"btn btn-primary"},"Login"),e&&a.a.createElement("img",{alt:"img",src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="}))))}}]),t}(a.a.Component);var B=Object(o.b)((function(e){return{loggingIn:e.authentication.loggingIn}}))(M),D=function(e){function t(e){var r;Object(c.a)(this,t);var n=(r=Object(u.a)(this,Object(A.a)(t).call(this,e))).props.dispatch;return d.listen((function(e,t){n(I.clear())})),r}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.alert;return a.a.createElement("div",{className:"jumbotron"},a.a.createElement("div",{className:"container"},a.a.createElement("div",{className:"col-sm-8 col-sm-offset-2"},e.message&&a.a.createElement("div",{className:"alert ".concat(e.type)},e.message),a.a.createElement(m.c,{history:d},a.a.createElement("div",null,a.a.createElement(y,{exact:!0,path:"/",component:k}),a.a.createElement(m.b,{path:"/login",component:B}))))))}}]),t}(a.a.Component);var F=Object(o.b)((function(e){return{alert:e.alert}}))(D);!function(){var e=[{id:1,username:"test",password:"test",firstName:"Test",lastName:"User"}],t=window.fetch;window.fetch=function(r,n){return new Promise((function(a,s){setTimeout((function(){if(r.endsWith("/users/authenticate")&&"POST"===n.method){var o=JSON.parse(n.body),c=e.filter((function(e){return e.username===o.username&&e.password===o.password}));if(c.length){var i=c[0],u={id:i.id,username:i.username,firstName:i.firstName,lastName:i.lastName,token:"fake-jwt-token"};a({ok:!0,text:function(){return Promise.resolve(JSON.stringify(u))}})}else s("Username or password is incorrect")}else r.endsWith("/users")&&"GET"===n.method?n.headers&&"Bearer fake-jwt-token"===n.headers.Authorization?a({ok:!0,text:function(){return Promise.resolve(JSON.stringify(e))}}):s("Unauthorised"):t(r,n).then((function(e){return a(e)}))}),500)}))}}(),Object(s.render)(a.a.createElement(o.a,{store:R},a.a.createElement(F,null)),document.getElementById("root"))}},[[33,1,2]]]);
//# sourceMappingURL=main.1989589e.chunk.js.map